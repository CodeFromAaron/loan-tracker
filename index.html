<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Money Owed — AUD</title>
  <link rel="stylesheet" href="styles.css">
  <script type="importmap">
  {
    "imports": {
      "date-fns": "https://esm.sh/date-fns@2.30.0"
    }
  }
  </script>
</head>
<body>
  <!-- PIN overlay: blocks access until correct PIN entered -->
  <div id="pinOverlay" class="pin-overlay" aria-hidden="false">
    <div class="pin-box" role="dialog" aria-modal="true" aria-label="Enter PIN">
      <h2>Enter PIN</h2>
      <p style="margin:8px 0 12px;font-size:14px;color:var(--muted);line-height:1.3">
        This simple page keeps track of money owed to you in AUD with due dates. Use the PIN below to open the list and update entries — you can mark items paid or edit details as needed.
      </p>

      <!-- role selector shown at login so user chooses who they are after unlocking -->
      <label for="roleSelect" style="display:block;margin-bottom:8px;font-size:13px;color:var(--muted);text-align:left">I am:</label>
      <select id="roleSelect" style="width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef;margin-bottom:10px">
        <option value="me">Aaron</option>
        <option value="mother">Nicola</option>
      </select>

      <input id="pinInput" type="password" inputmode="numeric" maxlength="6" placeholder="••••" />
      <div class="pin-actions">
        <button id="pinSubmit">Unlock</button>
        <button id="pinClear" class="ghost">Clear</button>
        <button id="pinHint" class="ghost">Hint</button>
      </div>
      <div id="pinMsg" class="pin-msg" aria-live="polite"></div>
    </div>
  </div>

  <main id="app" aria-hidden="true">
    <header>

      <h1>Money owed (AUD)</h1>
      <div class="top-actions">
        <button id="exportCsv">Export CSV</button>
        <button id="importCsv">Import CSV</button>
        <button id="toggleArchived" class="ghost">Archived</button>
      </div>
    </header>

    <section id="formSection">
      <form id="entryForm" autocomplete="off">
        <select id="person" name="person" required>
          <option value="Aaron">Aaron</option>
          <option value="Nicola">Nicola</option>
          <option value="Friend">Friend</option>
          <option value="Other">Other...</option>
        </select>
        <input id="personOther" name="personOther" placeholder="If Other, enter name" style="display:none" />
        <input id="amount" name="amount" placeholder="Amount (AUD)" inputmode="decimal" required />
        <input id="dueDate" name="dueDate" type="date" required />
        <select id="status" name="status" aria-label="Status">
          <option value="owed">Owed</option>
          <option value="paid">Paid</option>
        </select>

        <!-- new: partial payment amount in AUD -->
        <label for="paidAmount" style="width:100%;font-size:13px;color:var(--muted);text-align:left;margin-top:4px">Paid (AUD)</label>
        <input id="paidAmount" name="paidAmount" type="number" min="0" step="0.01" value="0.00" inputmode="decimal" style="flex:1 1 120px;padding:10px;border-radius:8px;border:1px solid #e6e9ef;background:transparent" />

        <button id="saveBtn" type="submit">Add</button>
        <button id="clearBtn" type="button" class="ghost">Clear</button>
      </form>
    </section>

    <section id="listSection" aria-live="polite">
      <ul id="entries"></ul>
      <div id="empty">No entries yet.</div>
    </section>

    <!-- archived section; hidden by default and toggled via Archived button -->
    <section id="archivedSection" style="display:none;background:var(--card);padding:10px;border-radius:12px;box-shadow:0 1px 3px rgba(2,6,23,0.06);">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
        <strong>Archived (paid) loans</strong>
        <div>
          <button id="clearArchived" class="ghost">Clear All</button>
        </div>
      </div>
      <ul id="archivedEntries" style="list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px"></ul>
      <div id="archivedEmpty" class="empty">No archived items.</div>
    </section>

    <footer>
      <small>Tap an entry to edit. Long-press (or hold) to mark paid/unpaid quickly.</small>
    </footer>
  </main>

  <input id="fileInput" type="file" accept=".csv" style="display:none" />

  <!-- right-side thermometer total tracker -->
  <aside id="thermometer" aria-hidden="false" title="Total paid across all loans">
    <div class="thermometer-shell">
      <!-- small minimize button -->
      <button id="thermoToggle" class="thermo-toggle" aria-pressed="false" title="Minimise thermometer">—</button>

      <!-- celebration emoji shown at top when full -->
      <div id="thermoEmoji" class="thermo-emoji" aria-hidden="true"></div>
      <div class="thermometer-bulb"></div>
      <div class="thermometer-track">
        <div id="thermoFill" class="thermo-fill" style="height:0%"></div>
      </div>
      <div class="thermo-labels">
        <div class="thermo-amount" id="thermoLabel">AUD 0.00 / AUD 0.00</div>
        <div class="thermo-percent" id="thermoPercent">0%</div>
      </div>
    </div>
  </aside>

  <!-- celebration container for falling money -->
  <div id="moneyContainer" aria-hidden="true" style="pointer-events:none;position:fixed;inset:0;overflow:hidden;z-index:9998"></div>

  <script type="module" src="main.js"></script>
</body>
</html>